# 安装与发布

## 一、本地安装 .vsix

### 1. 打包

在项目根目录执行：

```bash
npm run compile
npm run package
```

生成的 `.vsix` 位于 `out/knowledge-<版本号>.vsix`（例如 `out/knowledge-0.0.1.vsix`）。

### 2. 安装方式

**方式 A：命令行（推荐）**

```bash
# VS Code
code --install-extension ./out/knowledge-0.0.1.vsix

# Cursor
cursor --install-extension ./out/knowledge-0.0.1.vsix
```

成功后会提示 `Extension 'Knowledge' was successfully installed.`，执行「开发者: 重新加载窗口」后生效。

**方式 B：在编辑器内安装**

1. `Cmd+Shift+P`（macOS）或 `Ctrl+Shift+P`（Windows/Linux）
2. 选择 **Extensions: Install from VSIX...**
3. 选中 `out/knowledge-0.0.1.vsix` 并打开
4. 在扩展列表中可看到 Knowledge，未出现时可重载窗口

---

## 二、发布到 VS Code 插件市场

### 前置条件

1. **Microsoft 账号**：用于登录 [Visual Studio Marketplace](https://marketplace.visualstudio.com/)。
2. **发布者 (Publisher)**：若还没有，需先创建：
   - 打开 [管理发布者](https://marketplace.visualstudio.com/manage)
   - 用 Microsoft 账号登录后点击 **Create Publisher**
   - 填写发布者 ID（如 `netfere`）、名称等并创建
3. **package.json** 中的 `publisher` 必须与上述发布者 ID 一致（本项目为 `netfere`）。

### 获取 Personal Access Token (PAT)

1. 打开 [Azure DevOps 个人访问令牌](https://dev.azure.com/?appHint=Tokens)
2. 或直接访问：<https://aka.ms/SigninAzureDevOps> → 用户设置 → **Personal access tokens**
3. **New Token**：
   - Name：随意（如 `vsce-publish`）
   - Organization：选 **All accessible organizations** 或你的组织
   - Expiration：按需选择
   - Scopes：勾选 **Custom defined** → 只勾选 **Marketplace** → **Manage**
4. 创建后**复制并保存** Token（只显示一次）。

### 发布步骤

1. **安装/使用 vsce**（项目已包含 `@vscode/vsce`）：

   ```bash
   npx vsce login <发布者ID>
   ```
   按提示粘贴上一步的 PAT。例如：
   ```bash
   npx vsce login netfere
   ```

2. **（推荐）发布前检查**：

   - 在 `package.json` 中确认 `version`（如 `0.0.1`），每次发布新版本需递增。
   - 更新 `CHANGELOG.md`，便于用户在市场中查看更新说明。

3. **执行发布**：

   ```bash
   npm run compile
   npm run package
   npm run publish:vsce
   ```
   或直接：
   ```bash
   npx vsce publish
   ```

4. 发布成功后，扩展会出现在 [VS Code Marketplace](https://marketplace.visualstudio.com/) 中，用户可通过扩展面板搜索 **Knowledge** 或 **netfere** 安装。

### 发布到 Open VSX（可选）

若希望插件在 **VSCodium** 或 **Open VSX** 上可用，可额外发布到 [Open VSX Registry](https://open-vsx.org/)：

```bash
npm install -g ovsx
ovsx publish
```

需在 <https://open-vsx.org/> 注册账号并创建 PAT，按 `ovsx` 的提示登录后发布。

## github actions
```
git tag v0.0.1
git push origin v0.0.1
```